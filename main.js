(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var e=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClose=this._handleOverlayClose.bind(this)}var n,o;return n=e,(o=[{key:"open",value:function(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("click",this._handleOverlayClose),this._popup.classList.add("popup_opened")}},{key:"close",value:function(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("click",this._handleOverlayClose),this._popup.classList.remove("popup_opened")}},{key:"setEventListeners",value:function(){var t=this;this._closeButton=this._popup.querySelector(".popup__close-button"),this._closeButton.addEventListener("click",(function(){return t.close()}))}},{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"_handleOverlayClose",value:function(t){t.target.classList.contains("popup_opened")&&this.close()}}])&&t(n.prototype,o),e}();function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e,n){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(f,t);var e,n,u,s,l=(u=f,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(u);if(s){var n=c(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return a(this,t)});function f(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),(n=l.call(this,t))._callBackSubmit=e,n._submitForm=n._popup.querySelector(".popup__container"),n}return e=f,(n=[{key:"setEventListeners",value:function(){var t=this;r(c(f.prototype),"setEventListeners",this).call(this),this._submitForm.addEventListener("submit",(function(e){e.preventDefault(),t._callBackSubmit(),t.close()}))}},{key:"setObjectToRemove",value:function(t){this._objectToRemove=t}},{key:"returnObject",value:function(){return this._objectToRemove}},{key:"removeItem",value:function(){this._objectToRemove.remove()}}])&&o(e.prototype,n),f}(e);function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var l=function(){function t(e,n,o){var r=e.data,i=e.handleCardClick,a=e.handleDeleteClick,c=e.handleLikeClick;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._fotoTitle=r.name,this._fotoLink=r.link,this._likesArray=r.likes,this._cardId=r._id,this._ownerId=r.owner._id,this._templateSelector=n,this._handleCardClick=i,this._handleDeleteClick=a,this._handleLikeClick=c,this._myId=o}var e,n;return e=t,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".foto-table__list").cloneNode(!0)}},{key:"_checkIsLiked",value:function(){var t=this;return this._isLiked=!1,this._likesArray.forEach((function(e){e._id===t._myId&&(t._isLiked=!0)})),this._isLiked}},{key:"resetLikesArray",value:function(t){this._likesArray=t,this._element.querySelector(".foto-table__likes-number").textContent=t.length,this._element.querySelector(".foto-table__like-button").classList.toggle("foto-table__like-button_black")}},{key:"_setEventListeners",value:function(){var t=this;this._currentFoto=this._element.querySelector(".foto-table__foto"),this._element.querySelector(".foto-table__like-button").addEventListener("click",(function(e){console.log(t._checkIsLiked()),t._handleLikeClick(t._cardId,t._checkIsLiked())})),this._element.querySelector(".foto-table__delete-button").addEventListener("click",(function(e){t._obj=e.target.closest(".foto-table__list"),t._handleDeleteClick(t._obj)})),this._currentFoto.addEventListener("click",(function(e){t._handleCardClick()})),this._element.querySelector(".foto-table__likes-number").textContent=this._likesArray.length}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._setEventListeners(),this._checkIsLiked()&&this._element.querySelector(".foto-table__like-button").classList.add("foto-table__like-button_black"),this._ownerId!==this._myId&&this._element.querySelector(".foto-table__delete-button").classList.add("foto-table__delete-button_content_hidden"),this._element.id=this._cardId,this._element.querySelector(".foto-table__name").textContent=this._fotoTitle,this._currentFoto.src=this._fotoLink,this._currentFoto.alt=this._fotoTitle,this._element}}])&&s(e.prototype,n),t}();function f(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var p={formSelector:".popup__container",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_state_notActive",inputErrorClass:"popup__input_state_invalid",errorClass:".popup__error"},h=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._validationConfig=e,this._formElement=n,this._openedPopup=this._formElement.parentElement,this._inputList=this._openedPopup.querySelectorAll(this._validationConfig.inputSelector),this._errorList=this._openedPopup.querySelectorAll(this._validationConfig.errorClass),this._submitButton=this._openedPopup.querySelector(this._validationConfig.submitButtonSelector)}var e,n;return e=t,(n=[{key:"_showError",value:function(t){this._formElement.querySelector("#".concat(t.id,"-error")).textContent=t.validationMessage,t.classList.add(this._validationConfig.inputErrorClass)}},{key:"_hideError",value:function(t){this._formElement.querySelector("#".concat(t.id,"-error")).textContent="",t.classList.remove(this._validationConfig.inputErrorClass)}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideError(t):this._showError(t)}},{key:"setButtonState",value:function(t){t?(this._submitButton.classList.remove(this._validationConfig.inactiveButtonClass),this._submitButton.disabled=!1):(this._submitButton.classList.add(this._validationConfig.inactiveButtonClass),this._submitButton.disabled=!0)}},{key:"resetInputAndError",value:function(){var t=this;this._errorList.forEach((function(t){t.textContent=""})),this._inputList.forEach((function(e){e.classList.remove(t._validationConfig.inputErrorClass)}))}},{key:"enableValidation",value:function(){var t=this;this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t.setButtonState(t._formElement.checkValidity())}))}))}}])&&f(e.prototype,n),t}();function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function y(t,e,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t,e){return!e||"object"!==_(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=b(o);if(r){var n=b(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return m(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._callBackSubmit=e,n._submitForm=n._popup.querySelector(".popup__container"),n}return e=a,(n=[{key:"_getInputValues",value:function(){var t=this;return this._inputList=this._submitForm.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach((function(e){return t._formValues[e.name]=e.value})),this._formValues}},{key:"setEventListeners",value:function(){var t=this;y(b(a.prototype),"setEventListeners",this).call(this),this._submitForm.addEventListener("submit",(function(e){e.preventDefault(),t._callBackSubmit(t._getInputValues()),t.close()}))}},{key:"close",value:function(){y(b(a.prototype),"close",this).call(this),this._submitForm.reset()}}])&&d(e.prototype,n),a}(e);function g(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var E=function(){function t(e,n){var o=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=o,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"prependItem",value:function(t){this._container.prepend(t)}},{key:"renderItems",value:function(t){var e=this;this._renderedItems=t,this._renderedItems.forEach((function(t){return e._renderer(t)}))}},{key:"setItem",value:function(t){this._container.append(t)}}])&&g(e.prototype,n),t}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function L(t,e,n){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=O(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=O(o);if(r){var n=O(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return j(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t))._background=e._popup.querySelector(".popup__background"),e._title=e._popup.querySelector(".popup__pic-title"),e}return e=a,(n=[{key:"open",value:function(t){this._background.src=t.link,this._title.textContent=t.name,this._background.alt=t.name,L(O(a.prototype),"open",this).call(this)}}])&&C(e.prototype,n),a}(e);function P(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var q=function(){function t(e){var n=e.nameSelector,o=e.aboutSelector,r=e.avatarSelector;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._nameElement=document.querySelector(n),this._aboutElement=document.querySelector(o),this._nameInput=document.querySelector("#name-input"),this._jobInput=document.querySelector("#job-input"),this._avatarElement=document.querySelector(r)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){var t={};return t.name=this._nameElement.textContent,t.about=this._aboutElement.textContent,t}},{key:"setUserInfo",value:function(t){this._nameElement.textContent=t.name,this._aboutElement.textContent=t.about,this._userId=t._id}},{key:"pasteUserInfo",value:function(t){this._nameInput.value=t.name,this._jobInput.value=t.about}},{key:"setUserAvatar",value:function(t){this._avatarElement.src=t}},{key:"getUserId",value:function(){return this._userId}}])&&P(e.prototype,n),t}();function T(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var R=function(){function t(e){var n=e.baseUrl,o=e.headers;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._baseUrl=n,this._headers=o,this._authorization=o.authorization}var e,n;return e=t,(n=[{key:"_setFetch",value:function(t,e){return fetch("".concat(this._baseUrl).concat(t),{method:e,headers:{authorization:this._authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():t.status}))}},{key:"getUserInfo",value:function(){return this._setFetch("/users/me","GET")}},{key:"getCardArray",value:function(){return this._setFetch("/cards","GET")}},{key:"updateUserInfo",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/cohort-20/users/me",{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.about})}).then((function(t){return t.ok?t.json():t.status}))}},{key:"postCard",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/cohort-20/cards",{method:"POST",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"deleteCard",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/cohort-20/cards/".concat(t),{method:"DELETE",headers:{authorization:this._authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"putLike",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/cohort-20/cards/likes/".concat(t),{method:"PUT",headers:{authorization:this._authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"deleteLike",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/cohort-20/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:this._authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"changeAvatar",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/cohort-20/users/me/avatar",{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}}])&&T(e.prototype,n),t}(),A=document.querySelector(".profile__edit-button"),U=document.querySelector(".popup_content_edit-profile").querySelector(".popup__container"),B=document.querySelector(".popup_content_add-pic"),x=document.querySelector(".profile__add-pic-button"),z=B.querySelector(".popup__container"),D=document.querySelector(".popup_content_change-ava").querySelector(".popup__container"),F=document.querySelector(".profile__container"),V=new R({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-20",headers:{authorization:"6ce3acee-c27a-427e-ae19-0119209cb02d","Content-Type":"application/json"}});function N(t){var e=new l({data:t,handleCardClick:function(){M.open(t)},handleDeleteClick:function(t){Y.open(),Y.setObjectToRemove(t)},handleLikeClick:function(t,n){n?V.deleteLike(t).then((function(t){console.log(t),e.resetLikesArray(t.likes)})):V.putLike(t).then((function(t){console.log(t),e.resetLikesArray(t.likes)}))}},"#card",Q.getUserId());return e.generateCard()}var J=new h(p,U);J.enableValidation(),J.setButtonState(!1);var G=new h(p,z);G.enableValidation();var H=new h(p,D);H.enableValidation(),H.setButtonState(!1);var M=new I(".popup_content_full-pic");M.setEventListeners();var K=new E({renderer:function(t){var e=N(t);K.setItem(e)}},".foto-table"),Q=new q({nameSelector:".profile__user-name",aboutSelector:".profile__profession",avatarSelector:".profile__foto"}),W=new k(".popup_content_edit-profile",(function(t){var e={name:t.name,about:t.job};V.updateUserInfo(e).then((function(t){console.log(t),Q.setUserInfo(e)})).catch((function(t){return console.log(t)}))}));W.setEventListeners(),A.addEventListener("click",(function(){J.resetInputAndError();var t=Q.getUserInfo();Q.pasteUserInfo(t),W.open()}));var X=new k(".popup_content_add-pic",(function(t){var e={name:"".concat(t.picName),link:"".concat(t.picLink),likes:[],owner:{_id:Q.getUserId()}};V.postCard(e).then((function(t){console.log(t);var n=N(Object.assign(e,t));console.log(n),K.prependItem(n)}))}));X.setEventListeners(),x.addEventListener("click",(function(){G.resetInputAndError(),X.open()}));var Y=new u(".popup_content_delete",(function(){V.deleteCard(Y.returnObject().id).then((function(t){console.log(t),Y.removeItem()})).catch((function(t){return console.log(t)}))}));Y.setEventListeners();var Z=new k(".popup_content_change-ava",(function(t){console.log(t.avaLink),V.changeAvatar(t.avaLink).then((function(t){Q.setUserAvatar(t.avatar)}))}));Z.setEventListeners(),F.addEventListener("click",(function(){H.resetInputAndError(),Z.open()})),V.getUserInfo().then((function(t){Q.setUserInfo(t),Q.setUserAvatar(t.avatar)})).catch((function(t){return console.log(t)})),V.getCardArray().then((function(t){K.renderItems(t),console.log(t)})).catch((function(t){return console.log(t)}))})();